<!DOCTYPE html>
<html>
    <head>
        <title>Extractor</title>
    </head>
    <body>
        <p> Extraction des donn√©es </p>


    </body>
</html>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script>
  'python3 -m http,serveur 8000'
  var apiKey = 'AIzaSyBZ-BcTFC8CFSfr4O5k_MrzpfuGw7j2H3U'
  var json = []
  var json_name = "video_tim"

  d3.json("data/brut/watch_history_1.json").then(function(data){
    console.log(data)
    var exist = []
    data.forEach((item, i) => {
        if(item.titleUrl != undefined){
          video_id = item.titleUrl.replace("https://www.youtube.com/watch?v=","");
          exist.push(video_id)
          if(!(exist.includes('video'))){

            var url = "https://www.googleapis.com/youtube/v3/videos?part=id%2C+snippet&id="+video_id+"&key="+apiKey;
            $.get(url, function(data2){
              console.log(data2)
              data2["date"] = item.time;
              json.push(data2)
            })
          }
        }
    });
    setTimeout(function(){
      download(JSON.stringify(json), json_name+".json", "text/html");
      console.log(json);
  },500)


  });

  function download(content, fileName, contentType) {
     const a = document.createElement("a");
     const file = new Blob([content], { type: contentType });
     a.href = URL.createObjectURL(file);
     a.download = fileName;
     a.click();
  }

</script>
